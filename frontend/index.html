<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üåç Deprem Takip Sistemi</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #0d1117;
            color: #c9d1d9;
            overflow-x: hidden;
        }
        
        #header {
            background: linear-gradient(135deg, #1f2937 0%, #111827 100%);
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            border-bottom: 3px solid #dc2626;
        }
        
        #header h1 {
            font-size: 1.8em;
            margin-bottom: 5px;
            color: #f3f4f6;
            font-weight: 700;
        }
        
        #header p {
            opacity: 0.85;
            font-size: 0.9em;
            color: #d1d5db;
        }
        
        #controls {
            background: #161b22;
            padding: 10px;
            display: flex;
            gap: 8px;
            align-items: center;
            flex-wrap: wrap;
            border-bottom: 2px solid #30363d;
        }
        
        .btn {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 600;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .btn:hover {
            background: linear-gradient(135deg, #b91c1c, #7f1d1d);
            transform: translateY(-2px);
        }
        
        .filter-group {
            display: flex;
            gap: 5px;
            align-items: center;
        }
        
        .filter-group label {
            font-size: 13px;
            color: #d1d5db;
            font-weight: 500;
            white-space: nowrap;
        }
        
        .filter-group select,
        .filter-group input {
            background: #0d1117;
            color: #f3f4f6;
            border: 1.5px solid #30363d;
            padding: 6px 10px;
            border-radius: 6px;
            font-size: 13px;
        }
        
        #mainContainer {
            display: flex;
            height: calc(100vh - 180px);
        }
        
        #leftPanel {
            width: 320px;
            background: #161b22;
            border-right: 2px solid #30363d;
            overflow-y: auto;
            padding: 15px;
        }
        
        #map {
            flex: 1;
        }
        
        .panel-section {
            margin-bottom: 20px;
            background: #1f2937;
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #30363d;
        }
        
        .panel-section h3 {
            font-size: 1em;
            margin-bottom: 10px;
            color: #f3f4f6;
            border-bottom: 2px solid #dc2626;
            padding-bottom: 5px;
        }
        
        .earthquake-item {
            background: #0d1117;
            padding: 10px;
            margin: 8px 0;
            border-radius: 6px;
            border-left: 4px solid;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .earthquake-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        .earthquake-item.mag-high { border-left-color: #dc2626; }
        .earthquake-item.mag-medium { border-left-color: #f97316; }
        .earthquake-item.mag-low { border-left-color: #eab308; }
        
        .eq-magnitude {
            font-size: 1.3em;
            font-weight: bold;
            color: #dc2626;
        }
        
        .eq-location {
            font-size: 0.85em;
            color: #9ca3af;
            margin-top: 3px;
        }
        
        .eq-time {
            font-size: 0.75em;
            color: #6b7280;
            margin-top: 3px;
        }
        
        .legend {
            background: rgba(22, 27, 34, 0.95);
            padding: 15px;
            margin: 10px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.5);
            border: 1.5px solid #30363d;
        }
        
        .legend h4 {
            margin: 0 0 10px 0;
            color: #f3f4f6;
            font-size: 14px;
            font-weight: 600;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            margin: 6px 0;
            font-size: 12px;
            color: #c9d1d9;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 8px;
            border: 2px solid #30363d;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin: 0;
            cursor: pointer;
        }
        
        .checkbox-group input[type="checkbox"] {
            margin-right: 8px;
            cursor: pointer;
        }
        
        .checkbox-group label {
            font-size: 13px;
        }
        
        #autoRefresh {
            position: fixed;
            top: 80px;
            right: 10px;
            background: #1f2937;
            padding: 8px 12px;
            border-radius: 8px;
            border: 1px solid #30363d;
            font-size: 11px;
            color: #22c55e;
            z-index: 1000;
        }
        
        .anomaly-alert {
            background: linear-gradient(135deg, #dc2626, #991b1b);
            color: white;
            padding: 12px 20px;
            margin: 0;
            text-align: center;
            animation: pulse 2.5s infinite;
            border-bottom: 3px solid #7f1d1d;
            font-size: 0.9em;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }
        
        .panel-toggle {
            display: none;
            background: #dc2626;
            color: white;
            border: none;
            padding: 12px;
            width: 100%;
            text-align: left;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            border-radius: 6px;
            margin-bottom: 5px;
            transition: all 0.3s;
        }
        
        .panel-toggle:active {
            background: #b91c1c;
        }
        
        .panel-toggle::after {
            content: '‚ñº';
            float: right;
            transition: transform 0.3s;
        }
        
        .panel-toggle.active::after {
            transform: rotate(180deg);
        }
        
        @media (max-width: 768px) {
            .panel-toggle {
                display: block;
            }
            
            #controls {
                max-height: 0;
                padding: 0;
                border: none;
            }
            
            #controls.expanded {
                max-height: 500px;
                padding: 8px;
                border-bottom: 2px solid #30363d;
            }
            
            .panel-section {
                max-height: 0;
                padding: 0;
                margin: 0;
                border: none;
                opacity: 0;
            }
            
            .panel-section.expanded {
                max-height: 500px;
                padding: 15px;
                margin-bottom: 15px;
                border: 1px solid #30363d;
                opacity: 1;
            }
            
            #mainContainer {
                flex-direction: column;
                height: auto;
                min-height: 70vh;
            }
            
            #leftPanel {
                width: 100%;
                border-right: none;
                border-bottom: 2px solid #30363d;
            }
            
            #map {
                min-height: 60vh;
                height: 60vh;
            }
            
            .legend {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>üåç Deprem Takip ve Anomali Tespit Sistemi</h1>
        <p>T√ºrkiye ve Global Deprem Verileri - Ger√ßek Zamanlƒ± ƒ∞zleme</p>
    </div>
    
    <button class="panel-toggle" onclick="togglePanel('controls')">
        üéõÔ∏è Filtreler
    </button>
    
    <div id="controls">
        <button class="btn" onclick="refreshData()">üîÑ Yenile</button>
        
        <div class="filter-group">
            <label>Kaynak:</label>
            <select id="sourceFilter" onchange="filterEarthquakes()">
                <option value="all">T√ºm√º</option>
                <option value="Kandilli">Kandilli</option>
                <option value="USGS">USGS</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label>Min B√ºy√ºkl√ºk:</label>
            <input type="number" id="magFilter" value="2.5" step="0.5" min="0" max="10" onchange="filterEarthquakes()">
        </div>
        
        <div class="filter-group">
            <label>Zaman:</label>
            <select id="timeFilter" onchange="filterEarthquakes()">
                <option value="24">Son 24 Saat</option>
                <option value="48" selected>Son 48 Saat</option>
                <option value="168">Son 7 G√ºn</option>
            </select>
        </div>
        
        <div class="filter-group">
            <label>G√∂r√ºn√ºm:</label>
            <select id="viewMode" onchange="changeViewMode()">
                <option value="markers" selected>Noktalar</option>
                <option value="heatmap">Isƒ± Haritasƒ±</option>
            </select>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="showFaultsTurkey" onchange="toggleFaultsTurkey()">
            <label for="showFaultsTurkey">Faylar (TR)</label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="showFaultsGlobal" onchange="toggleFaultsGlobal()">
            <label for="showFaultsGlobal">Faylar (Global)</label>
        </div>
        
        <div class="checkbox-group">
            <input type="checkbox" id="showPlates" onchange="togglePlates()">
            <label for="showPlates">Tektonik Plakalar</label>
        </div>
    </div>
    
    <div id="mainContainer">
        <div id="leftPanel">
            <button class="panel-toggle" onclick="togglePanel('statsSection')">
                üìä ƒ∞statistikler
            </button>
            
            <div id="statsSection" class="panel-section">
                <h3>üìä ƒ∞statistikler</h3>
                <div style="color: #9ca3af; font-size: 0.9em; line-height: 1.8;">
                    <div><strong>Toplam (24h):</strong> <span id="stat1">-</span></div>
                    <div><strong>En B√ºy√ºk (24h):</strong> <span id="stat2">-</span></div>
                    <div><strong>Aktif Anomali:</strong> <span id="stat3">-</span></div>
                    <div><strong>Son G√ºncelleme:</strong> <span id="stat4">-</span></div>
                </div>
            </div>
            
            <button class="panel-toggle" onclick="togglePanel('topSection')">
                üî¥ En B√ºy√ºk 5 Deprem
            </button>
            
            <div id="topSection" class="panel-section">
                <h3>üî¥ En B√ºy√ºk 5 Deprem</h3>
                <div id="topEarthquakes">
                    <p style="color: #6b7280; font-size: 0.85em;">Y√ºkleniyor...</p>
                </div>
            </div>
        </div>
        
        <div id="map"></div>
    </div>
    
    <div id="autoRefresh">‚óè Otomatik Yenileme Aktif (5dk)</div>
    
    <script>
        let map;
        let markers = [];
        let heatmap = null;
        let anomalyCircles = [];
        let allEarthquakes = [];
        let anomalies = [];
        let autoRefreshInterval;
        let faultLinesTurkeyLoaded = false;
        let faultLinesGlobalLoaded = false;
        let tectonicPlatesLoaded = false;
        
        function togglePanel(panelId) {
            const panel = document.getElementById(panelId);
            
            if (window.innerWidth <= 768) {
                if (panel.classList.contains('expanded')) {
                    panel.classList.remove('expanded');
                } else {
                    panel.classList.add('expanded');
                }
                
                const buttons = document.querySelectorAll('.panel-toggle');
                buttons.forEach(btn => {
                    const nextElement = btn.nextElementSibling;
                    if (nextElement && nextElement.id === panelId) {
                        btn.classList.toggle('active');
                    }
                });
            }
        }
        
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 39.0, lng: 35.0 },
                zoom: 6,
                gestureHandling: 'greedy',
                styles: [
                    { elementType: "geometry", stylers: [{ color: "#1a1f3a" }] },
                    { elementType: "labels.text.stroke", stylers: [{ color: "#0a0e27" }] },
                    { elementType: "labels.text.fill", stylers: [{ color: "#e5e7eb" }] },
                    {
                        featureType: "administrative.country",
                        elementType: "geometry.stroke",
                        stylers: [{ color: "#4a5568" }, { weight: 2 }]
                    },
                    {
                        featureType: "water",
                        elementType: "geometry",
                        stylers: [{ color: "#1e3a5f" }]
                    },
                    {
                        featureType: "landscape",
                        elementType: "geometry",
                        stylers: [{ color: "#2d3748" }]
                    }
                ]
            });
            
            const legend = document.createElement('div');
            legend.className = 'legend';
            legend.innerHTML = `
                <h4>Deprem B√ºy√ºkl√ºƒü√º</h4>
                <div class="legend-item">
                    <div class="legend-color" style="background: #22c55e;"></div>
                    <span>2.5 - 3.5</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #eab308;"></div>
                    <span>3.5 - 4.5</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #f97316;"></div>
                    <span>4.5 - 5.5</span>
                </div>
                <div class="legend-item">
                    <div class="legend-color" style="background: #dc2626;"></div>
                    <span>5.5+</span>
                </div>
            `;
            map.controls[google.maps.ControlPosition.RIGHT_BOTTOM].push(legend);
            
            loadData();
            startAutoRefresh();
        }
        
        async function loadData() {
            try {
                const hours = parseInt(document.getElementById('timeFilter').value);
                const response = await fetch(`/api/earthquakes?hours=${hours}`);
                const data = await response.json();
                
                allEarthquakes = data.earthquakes;
                
                const anomalyResponse = await fetch('/api/anomalies');
                const anomalyData = await anomalyResponse.json();
                anomalies = anomalyData.anomalies;
                
                const statsResponse = await fetch('/api/stats');
                const stats = await statsResponse.json();
                
                document.getElementById('stat1').textContent = stats.total_24h;
                document.getElementById('stat2').textContent = stats.max_magnitude_24h.toFixed(1);
                document.getElementById('stat3').textContent = stats.active_anomalies;
                document.getElementById('stat4').textContent = new Date(stats.last_update).toLocaleTimeString('tr-TR');
                
                updateTopEarthquakes();
                
                if (stats.active_anomalies > 0) {
                    showAnomalyAlert(anomalies);
                }
                
                filterEarthquakes();
                drawAnomalyZones();
                
            } catch (error) {
                console.error('Veri y√ºkleme hatasƒ±:', error);
            }
        }
        
        function updateTopEarthquakes() {
            const sorted = [...allEarthquakes].sort((a, b) => b.magnitude - a.magnitude).slice(0, 5);
            const container = document.getElementById('topEarthquakes');
            
            if (sorted.length === 0) {
                container.innerHTML = '<p style="color: #6b7280; font-size: 0.85em;">Veri yok</p>';
                return;
            }
            
            container.innerHTML = sorted.map(eq => {
                const magClass = eq.magnitude >= 5 ? 'mag-high' : eq.magnitude >= 4 ? 'mag-medium' : 'mag-low';
                const eqTime = new Date(eq.timestamp);
                
                return `
                    <div class="earthquake-item ${magClass}" onclick="focusEarthquake(${eq.latitude}, ${eq.longitude})">
                        <div class="eq-magnitude">M${eq.magnitude.toFixed(1)}</div>
                        <div class="eq-location">${eq.location.substring(0, 35)}...</div>
                        <div class="eq-time">${eqTime.toLocaleString('tr-TR')}</div>
                    </div>
                `;
            }).join('');
        }
        
        function focusEarthquake(lat, lon) {
            map.setCenter({ lat, lng: lon });
            map.setZoom(10);
        }
        
        function filterEarthquakes() {
            const viewMode = document.getElementById('viewMode').value;
            
            if (viewMode === 'heatmap') {
                showHeatmap();
            } else {
                showMarkers();
            }
        }
        
        function showMarkers() {
            if (heatmap) {
                heatmap.setMap(null);
            }
            
            markers.forEach(marker => marker.setMap(null));
            markers = [];
            
            const source = document.getElementById('sourceFilter').value;
            const minMag = parseFloat(document.getElementById('magFilter').value);
            const hours = parseInt(document.getElementById('timeFilter').value);
            
            const cutoff = new Date(Date.now() - hours * 60 * 60 * 1000);
            
            const filtered = allEarthquakes.filter(eq => {
                const matchSource = source === 'all' || eq.source === source;
                const matchMag = eq.magnitude >= minMag;
                const matchTime = new Date(eq.timestamp) >= cutoff;
                return matchSource && matchMag && matchTime;
            });
            
            const maxEq = filtered.reduce((max, eq) => eq.magnitude > max.magnitude ? eq : max, filtered[0] || { magnitude: 0 });
            
            filtered.forEach(eq => {
                const color = getMagnitudeColor(eq.magnitude);
                const isLargest = eq === maxEq;
                
                const marker = new google.maps.Marker({
                    position: { lat: eq.latitude, lng: eq.longitude },
                    map: map,
                    icon: {
                        path: google.maps.SymbolPath.CIRCLE,
                        scale: Math.max(eq.magnitude * 2.5, 5),
                        fillColor: color,
                        fillOpacity: 0.85,
                        strokeColor: '#ffffff',
                        strokeWeight: isLargest ? 3 : 2
                    },
                    title: 'B√ºy√ºkl√ºk ' + eq.magnitude + ' - ' + eq.location,
                    animation: isLargest ? google.maps.Animation.BOUNCE : null
                });
                
                const eqTime = new Date(eq.timestamp);
                
                const infoWindow = new google.maps.InfoWindow({
                    content: '<div style="color: #0d1117; padding: 16px;"><h3 style="color: #dc2626;">üìç Deprem</h3><p><strong>B√ºy√ºkl√ºk:</strong> ' + eq.magnitude.toFixed(1) + '</p><p><strong>Konum:</strong> ' + eq.location + '</p><p><strong>Saat:</strong> ' + eqTime.toLocaleTimeString('tr-TR') + '</p></div>'
                });
                
                marker.addListener('click', function() {
                    infoWindow.open(map, marker);
                });
                
                markers.push(marker);
            });
        }
        
        function showHeatmap() {
            markers.forEach(marker => marker.setMap(null));
            
            const source = document.getElementById('sourceFilter').value;
            const minMag = parseFloat(document.getElementById('magFilter').value);
            const hours = parseInt(document.getElementById('timeFilter').value);
            
            const cutoff = new Date(Date.now() - hours * 60 * 60 * 1000);
            
            const filtered = allEarthquakes.filter(eq => {
                const matchSource = source === 'all' || eq.source === source;
                const matchMag = eq.magnitude >= minMag;
                const matchTime = new Date(eq.timestamp) >= cutoff;
                return matchSource && matchMag && matchTime;
            });
            
            const heatmapData = filtered.map(eq => ({
                location: new google.maps.LatLng(eq.latitude, eq.longitude),
                weight: eq.magnitude
            }));
            
            if (heatmap) {
                heatmap.setMap(null);
            }
            
            heatmap = new google.maps.visualization.HeatmapLayer({
                data: heatmapData,
                radius: 20,
                opacity: 0.7
            });
            
            heatmap.setMap(map);
        }
        
        function drawAnomalyZones() {
            anomalyCircles.forEach(circle => circle.setMap(null));
            anomalyCircles = [];
            
            if (!anomalies || anomalies.length === 0) {
                return;
            }
            
            anomalies.forEach(anomaly => {
                const center = { lat: anomaly.latitude, lng: anomaly.longitude };
                
                const circle = new google.maps.Circle({
                    strokeColor: '#dc2626',
                    strokeOpacity: 0.4,
                    strokeWeight: 2,
                    fillColor: '#dc2626',
                    fillOpacity: 0.12,
                    map: map,
                    center: center,
                    radius: anomaly.radius_km * 1000
                });
                
                anomalyCircles.push(circle);
            });
        }
        
        async function loadFaultLinesTurkey() {
            console.log('üáπüá∑ T√ºrkiye fay hatlarƒ± y√ºkleniyor...');
            
            const turkeyFaults = {
                "type": "FeatureCollection",
                "features": [
                    {
                        "type": "Feature",
                        "properties": { "name": "Kuzey Anadolu Fay Zonu (KAFZ)" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [26.00, 40.90], [26.50, 40.85], [27.00, 40.80], [27.50, 40.75],
                                [28.00, 40.72], [28.50, 40.69], [29.00, 40.66], [29.50, 40.63],
                                [30.00, 40.60], [30.50, 40.58], [31.00, 40.55], [31.50, 40.53],
                                [32.00, 40.51], [32.50, 40.49], [33.00, 40.47], [33.50, 40.46],
                                [34.00, 40.45], [34.50, 40.43], [35.00, 40.41], [35.50, 40.39],
                                [36.00, 40.37], [36.50, 40.34], [37.00, 40.31], [37.50, 40.29],
                                [38.00, 40.27], [38.50, 40.25], [39.00, 40.23], [39.50, 40.20],
                                [40.00, 40.17], [40.50, 40.14], [41.00, 40.11], [41.50, 40.08],
                                [42.00, 40.06], [42.50, 40.04], [43.00, 40.03], [43.50, 40.02],
                                [44.00, 40.00]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Doƒüu Anadolu Fay Zonu (DAFZ)" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [35.50, 36.70], [35.80, 36.85], [36.10, 37.00], [36.40, 37.15],
                                [36.70, 37.30], [37.00, 37.45], [37.30, 37.60], [37.60, 37.75],
                                [37.90, 37.90], [38.20, 38.05], [38.50, 38.20], [38.80, 38.35],
                                [39.10, 38.50], [39.40, 38.65], [39.70, 38.80], [40.00, 38.95],
                                [40.30, 39.10], [40.60, 39.25], [40.90, 39.40], [41.20, 39.55],
                                [41.50, 39.70], [41.80, 39.85], [42.10, 40.00], [42.40, 40.15],
                                [42.70, 40.30], [43.00, 40.45], [43.30, 40.60], [43.60, 40.75],
                                [43.90, 40.90], [44.20, 41.05]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "√ñl√º Deniz Fay Zonu" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [35.40, 29.50], [35.45, 30.00], [35.50, 30.50], [35.55, 31.00],
                                [35.60, 31.50], [35.65, 32.00], [35.70, 32.50], [35.75, 33.00],
                                [35.80, 33.50], [35.90, 34.00], [36.00, 34.50], [36.10, 35.00],
                                [36.20, 35.50], [36.30, 36.00], [36.40, 36.50], [36.50, 37.00],
                                [36.60, 37.50]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Gediz Grabeni" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [26.30, 38.88], [26.55, 38.87], [26.80, 38.85], [27.05, 38.84],
                                [27.30, 38.82], [27.55, 38.81], [27.80, 38.79], [28.05, 38.77],
                                [28.30, 38.75], [28.55, 38.73], [28.80, 38.71], [29.05, 38.70],
                                [29.30, 38.68]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "B√ºy√ºk Menderes Grabeni" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [26.80, 37.90],[27.05, 37.89], [27.30, 37.87], [27.55, 37.85],
                                [27.80, 37.83], [28.05, 37.81], [28.30, 37.79], [28.55, 37.77],
                                [28.80, 37.75], [29.05, 37.73], [29.30, 37.71], [29.55, 37.70],
                                [29.80, 37.68]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "K√º√ß√ºk Menderes Grabeni" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [27.00, 38.20], [27.30, 38.18], [27.60, 38.16], [27.90, 38.14],
                                [28.20, 38.12], [28.50, 38.10]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Simav Grabeni" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [28.60, 39.20], [28.75, 39.18], [28.90, 39.15], [29.05, 39.13],
                                [29.20, 39.10], [29.35, 39.08], [29.50, 39.05], [29.65, 39.03],
                                [29.80, 39.00]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Marmara Faylarƒ± - Kuzey Kol" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [26.50, 40.45], [27.00, 40.50], [27.50, 40.55], [28.00, 40.58],
                                [28.50, 40.60], [29.00, 40.62], [29.50, 40.64], [30.00, 40.65]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Marmara Faylarƒ± - G√ºney Kol" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [28.50, 40.65], [29.00, 40.68], [29.50, 40.70], [30.00, 40.72],
                                [30.50, 40.73], [31.00, 40.74]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Ege Grabenleri - Kuzey" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [25.80, 39.60], [26.05, 39.55], [26.30, 39.50], [26.55, 39.45],
                                [26.80, 39.40], [27.05, 39.35], [27.30, 39.30]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Ege Grabenleri - Orta" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [25.80, 38.30], [26.05, 38.25], [26.30, 38.20], [26.55, 38.15],
                                [26.80, 38.10], [27.05, 38.05], [27.30, 38.00]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Ege Grabenleri - G√ºney" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [25.30, 37.20], [25.55, 37.15], [25.80, 37.10], [26.05, 37.05],
                                [26.30, 37.00], [26.55, 36.95], [26.80, 36.90]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Helenik Yay (Ege Dalma Zonu)" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [19.00, 36.30], [20.00, 36.60], [21.00, 36.95], [22.00, 37.35],
                                [23.00, 37.80], [24.00, 38.30], [25.00, 38.85], [26.00, 39.45],
                                [27.00, 40.00]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Ecemi≈ü Fay Zonu" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [34.50, 37.50], [34.70, 37.80], [34.90, 38.10], [35.10, 38.40],
                                [35.30, 38.70], [35.50, 39.00]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Tuz G√∂l√º Fay Zonu" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [33.00, 38.50], [33.30, 38.70], [33.60, 38.90], [33.90, 39.10],
                                [34.20, 39.30], [34.50, 39.50]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Tuzla Fay Zonu" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [36.50, 38.00], [36.80, 38.20], [37.10, 38.40], [37.40, 38.60],
                                [37.70, 38.80], [38.00, 39.00]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Malatya Fay Zonu" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [37.50, 38.20], [37.80, 38.30], [38.10, 38.40], [38.40, 38.50],
                                [38.70, 38.60], [39.00, 38.70]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Ovacƒ±k Fay Zonu" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [39.00, 39.20], [39.20, 39.30], [39.40, 39.40], [39.60, 39.50],
                                [39.80, 39.60], [40.00, 39.70]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Zagros Fay Zonu (T√ºrkiye Sƒ±nƒ±rƒ±)" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [44.00, 37.50], [44.50, 37.30], [45.00, 37.10], [45.50, 36.90],
                                [46.00, 36.70]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Kuzey ƒ∞ran Fay Zonu (T√ºrkiye Sƒ±nƒ±rƒ±)" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [43.50, 39.50], [44.00, 39.30], [44.50, 39.10], [45.00, 38.90],
                                [45.50, 38.70], [46.00, 38.50]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Kafkas Fay Zonu" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [40.50, 41.80], [41.00, 41.90], [41.50, 42.00], [42.00, 42.10],
                                [42.50, 42.20], [43.00, 42.30], [43.50, 42.40], [44.00, 42.50],
                                [44.50, 42.60], [45.00, 42.70], [45.50, 42.80], [46.00, 42.90]
                            ]
                        }
                    },
                    {
                        "type": "Feature",
                        "properties": { "name": "Kƒ±brƒ±s Yayƒ±" },
                        "geometry": {
                            "type": "LineString",
                            "coordinates": [
                                [28.00, 35.50], [29.00, 35.30], [30.00, 35.20], [31.00, 35.15],
                                [32.00, 35.10], [33.00, 35.08], [34.00, 35.10], [35.00, 35.20],
                                [36.00, 35.40]
                            ]
                        }
                    }
                ]
            };
            
            window.faultDataLayerTurkey = new google.maps.Data();
            window.faultDataLayerTurkey.addGeoJson(turkeyFaults);
            window.faultDataLayerTurkey.setMap(map);
            
            window.faultDataLayerTurkey.setStyle({
                strokeColor: '#d4c5a9',
                strokeWeight: 1.8,
                strokeOpacity: 0.9,
                zIndex: 150
            });
            
            window.faultDataLayerTurkey.addListener('click', event => {
                const name = event.feature.getProperty('name');
                const infoWindow = new google.maps.InfoWindow({
                    content: `
                        <div style="color: #0d1117; padding: 12px;">
                            <h3 style="margin: 0 0 8px 0; color: #d4c5a9; font-size: 14px; font-weight: 700;">
                                ${name}
                            </h3>
                            <p style="margin: 0; font-size: 12px; color: #6b7280;">
                                Aktif Fay Zonu
                            </p>
                        </div>
                    `,
                    position: event.latLng
                });
                infoWindow.open(map);
            });
            
            faultLinesTurkeyLoaded = true;
            console.log('‚úÖ T√ºrkiye fay hatlarƒ± y√ºklendi');
        }
        
        async function loadFaultLinesGlobal() {
            console.log('üåç Global fay hatlarƒ± y√ºkleniyor (GEM Active Faults)...');
            
            try {
                const response = await fetch('https://raw.githubusercontent.com/GEMScienceTools/gem-global-active-faults/master/geojson/gem_active_faults.geojson');
                const faultData = await response.json();
                
                window.faultDataLayerGlobal = new google.maps.Data();
                window.faultDataLayerGlobal.addGeoJson(faultData);
                window.faultDataLayerGlobal.setMap(map);
                
                window.faultDataLayerGlobal.setStyle({
                    strokeColor: '#d4c5a9',
                    strokeWeight: 1.3,
                    strokeOpacity: 0.75,
                    zIndex: 140,
                    fillOpacity: 0
                });
                
                window.faultDataLayerGlobal.addListener('click', event => {
                    const name = event.feature.getProperty('name') || event.feature.getProperty('fault_name') || 'Fay B√∂lgesi';
                    const faultType = event.feature.getProperty('slip_type') || 'Bilinmiyor';
                    
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="color: #0d1117; padding: 12px;">
                                <h3 style="margin: 0 0 8px 0; color: #d4c5a9; font-size: 14px; font-weight: 700;">
                                    ${name}
                                </h3>
                                <p style="margin: 0; font-size: 12px; color: #6b7280;">
                                    Aktif Fay - ${faultType}
                                </p>
                            </div>
                        `,
                        position: event.latLng
                    });
                    infoWindow.open(map);
                });
                
                faultLinesGlobalLoaded = true;
                console.log('‚úÖ Global fay hatlarƒ± y√ºklendi (GEM Active Faults)');
                
            } catch (error) {
                console.error('‚ùå Global fay hatlarƒ± y√ºkleme hatasƒ±:', error);
                alert('Global fay verileri y√ºklenemedi. ƒ∞nternet baƒülantƒ±nƒ±zƒ± kontrol edin.');
            }
        }
        
        async function loadTectonicPlates() {
            console.log('üåç Tektonik plakalar y√ºkleniyor...');
            
            try {
                const response = await fetch('https://raw.githubusercontent.com/fraxen/tectonicplates/master/GeoJSON/PB2002_boundaries.json');
                const data = await response.json();
                
                window.tectonicPlatesLayer = new google.maps.Data();
                window.tectonicPlatesLayer.addGeoJson(data);
                window.tectonicPlatesLayer.setMap(map);
                
                window.tectonicPlatesLayer.setStyle({
                    strokeColor: '#dc2626',
                    strokeWeight: 2,
                    strokeOpacity: 0.9,
                    zIndex: 200
                });
                
                window.tectonicPlatesLayer.addListener('click', event => {
                    const name = event.feature.getProperty('Name') || 'Plaka Sƒ±nƒ±rƒ±';
                    
                    const infoWindow = new google.maps.InfoWindow({
                        content: `
                            <div style="color: #0d1117; padding: 12px;">
                                <h3 style="margin: 0 0 8px 0; color: #dc2626; font-size: 14px; font-weight: 700;">
                                    üåç ${name}
                                </h3>
                                <p style="margin: 0; font-size: 12px; color: #6b7280;">
                                    Tektonik Plaka Sƒ±nƒ±rƒ±
                                </p>
                            </div>
                        `,
                        position: event.latLng
                    });
                    infoWindow.open(map);
                });
                
                tectonicPlatesLoaded = true;
                console.log('‚úÖ Tektonik plakalar y√ºklendi (GitHub - PB2002)');
                
            } catch (error) {
                console.error('‚ùå Tektonik plaka y√ºkleme hatasƒ±:', error);
            }
        }
        
        function toggleFaultsTurkey() {
            const show = document.getElementById('showFaultsTurkey').checked;
            
            if (show && !faultLinesTurkeyLoaded) {
                loadFaultLinesTurkey();
            } else if (window.faultDataLayerTurkey) {
                window.faultDataLayerTurkey.setMap(show ? map : null);
            }
        }
        
        function toggleFaultsGlobal() {
            const show = document.getElementById('showFaultsGlobal').checked;
            
            if (show && !faultLinesGlobalLoaded) {
                loadFaultLinesGlobal();
            } else if (window.faultDataLayerGlobal) {
                window.faultDataLayerGlobal.setMap(show ? map : null);
            }
        }
        
        function togglePlates() {
            const show = document.getElementById('showPlates').checked;
            
            if (show && !tectonicPlatesLoaded) {
                loadTectonicPlates();
            } else if (window.tectonicPlatesLayer) {
                window.tectonicPlatesLayer.setMap(show ? map : null);
            }
        }
        
        function changeViewMode() {
            filterEarthquakes();
        }
        
        function getMagnitudeColor(mag) {
            if (mag < 3.5) return '#22c55e';
            if (mag < 4.5) return '#eab308';
            if (mag < 5.5) return '#f97316';
            return '#dc2626';
        }
        
        function showAnomalyAlert(anomalies) {
            const oldAlert = document.querySelector('.anomaly-alert');
            if (oldAlert) oldAlert.remove();
            
            const alertDiv = document.createElement('div');
            alertDiv.className = 'anomaly-alert';
            alertDiv.innerHTML = '<strong>‚ö†Ô∏è ' + anomalies.length + ' B√∂lgede Anomali Tespit Edildi!</strong>';
            document.body.insertBefore(alertDiv, document.body.firstChild);
        }
        
        function refreshData() {
            loadData();
        }
        
        function startAutoRefresh() {
            autoRefreshInterval = setInterval(function() {
                console.log('Otomatik yenileme...');
                loadData();
            }, 5 * 60 * 1000);
        }
    </script>
    
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyD6sOp517PKb6Snl9mmk7AW3afLQrnJSDw&libraries=visualization&callback=initMap"></script>
</body>
</html>