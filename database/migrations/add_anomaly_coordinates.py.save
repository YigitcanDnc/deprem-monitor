# -*- coding: utf-8 -*-
"""
Anomalies tablosuna latitude ve longitude kolonlarƒ± ekle
"""
import os
from sqlalchemy import text, create_engine

# Database URL'i al
DATABASE_URL = os.getenv('DATABASE_URL')
if not DATABASE_URL:
    print("‚ùå DATABASE_URL bulunamadƒ±!")
    exit(1)

# PostgreSQL baƒülantƒ±sƒ±
engine = create_engine(DATABASE_URL)

def migrate():
    """Anomalies tablosunu g√ºncelle"""
    
    print("\n" + "="*60)
    print("üîß DATABASE Mƒ∞GRATƒ∞ON BA≈ûLIYOR")
    print("="*60)
    
    with engine.connect() as conn:
        try:
            # Mevcut kolonlarƒ± kontrol et
            print("\n1Ô∏è‚É£ Mevcut tablo yapƒ±sƒ± kontrol ediliyor...")
            result = conn.execute(text("""
                SELECT column_name 
                FROM information_schema.columns 
                WHERE table_name = 'anomalies'
            """))
            existing_columns = [row[0] for row in result]
            print(f"   ‚úÖ Mevcut kolonlar: {', '.join(existing_columns)}")
            
            # Kolonlarƒ± ekle
            columns_to_add = [
                ('latitude', 'FLOAT'),
                ('longitude', 'FLOAT'),
                ('radius_km', 'FLOAT DEFAULT 50.0'),
                ('earthquake_count', 'INTEGER DEFAULT 0'),
                ('baseline_rate', 'FLOAT DEFAULT 0.0'),
                ('current_rate', 'FLOAT DEFAULT 0.0'),
                ('resolved_at', 'TIMESTAMP')
            ]
            
            for col_name, col_type in columns_to_add:
                if col_name not in existing_columns:
                    print(f"\n‚úÖ '{col_name}' kolonu ekleniyor...")
                    conn.execute(text(f"""
                        ALTER TABLE anomalies 
                        ADD COLUMN {col_name} {col_type}
                    """))
                    conn.commit()
                    print(f"   ‚úÖ '{col_name}' eklendi")
                else:
                    print(f"\n‚úì '{col_name}' zaten mevcut")
            
            print("\n" + "="*60)
            print("‚úÖ Mƒ∞GRATƒ∞ON BA≈ûARIYLA TAMAMLANDI!")
            print("="*60 + "\n")
            
        except Exception as e:
            print(f"\n‚ùå Migration hatasƒ±: {e}")
            import traceback
            traceback.print_exc()
            conn.rollback()
            exit(1)

if __name__ == "__main__":
    migrate()
^x

